class PhoneNumberMask{static DEFAULT_MESSAGES={en:"Please enter a valid phone number.","en-US":"Please enter a valid phone number.",pt:"Digite um número de telefone válido.","pt-BR":"Digite um número de telefone válido.",es:"Ingrese un número de teléfono válido.",fr:"Veuillez entrer un numéro de téléphone valide.",de:"Bitte geben Sie eine gültige Telefonnummer ein."};constructor(e,t={}){if("string"==typeof e)this.input=document.querySelector(e);else{if(!(e instanceof HTMLElement))throw new Error("Invalid input element or selector provided to PhoneNumberMask.");this.input=e}if(!this.input)throw new Error("Input element not found for PhoneNumberMask.");this.options={masks:["(##) #####-####"],messages:{...PhoneNumberMask.DEFAULT_MESSAGES,...t.messages||{}},...t},Array.isArray(this.options.masks)||(this.options.masks=[this.options.masks]),this.masksData=this.options.masks.map((e=>this.parseMask(e))),this.activeMaskIndex=-1,this.setupEventListeners();const s=this.input.value;s&&this.setValue(s)}parseMask(e){let t="^",s=[],a=0,i=0;for(let n=0;n<e.length;n++)"#"===e[n]?(t+="(\\d?)",s.push({index:n,charIndex:a}),a++,i++):t+=this.escapeRegExp(e[n]);return t+="$",{regex:new RegExp(t),placeholders:s,mask:e,placeholderChar:"#",digitCount:i}}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getErrorMessage(){const e=navigator.languages||[navigator.language||navigator.userLanguage];for(const t of e){if(this.options.messages[t])return this.options.messages[t];const e=t.split("-")[0];if(this.options.messages[e])return this.options.messages[e]}return this.options.messages.en||PhoneNumberMask.DEFAULT_MESSAGES.en}static getLocalizedMessage(){const e=navigator.languages||[navigator.language||navigator.userLanguage];for(const t of e){if(PhoneNumberMask.DEFAULT_MESSAGES[t])return PhoneNumberMask.DEFAULT_MESSAGES[t];const e=t.split("-")[0];if(PhoneNumberMask.DEFAULT_MESSAGES[e])return PhoneNumberMask.DEFAULT_MESSAGES[e]}return PhoneNumberMask.DEFAULT_MESSAGES.en}static apply(e,t={}){document.querySelectorAll(e).forEach((e=>new PhoneNumberMask(e,t)))}setupEventListeners(){this.input.addEventListener("input",this.handleInput.bind(this)),this.input.addEventListener("blur",this.handleBlur.bind(this)),this.input.addEventListener("keydown",this.handleKeyDown.bind(this)),this.input.addEventListener("paste",this.handlePaste.bind(this))}handleKeyDown(e){const t=e.keyCode;if(!((e.ctrlKey||e.metaKey)&&[65,67,86,88].includes(t)||[9,27,13].includes(t)||t>=35&&t<=40))if(8===t||46===t){e.preventDefault();let s=this.input.selectionStart,a=this.input.selectionEnd,i=this.getUnmaskedValue(),n=i,r=this.getCursorPosInUnmaskedValue(s);const o=this.masksData[this.activeMaskIndex];if(s===a){if(8===t){let e=s-1;for(;e>=0&&o.mask[e]!==o.placeholderChar;)e--;e>=0&&(r=this.getCursorPosInUnmaskedValue(e),n=i.slice(0,r)+i.slice(r+1))}else if(46===t){let e=s;for(;e<o.mask.length&&o.mask[e]!==o.placeholderChar;)e++;if(e<o.mask.length){let t=this.getCursorPosInUnmaskedValue(e);n=i.slice(0,t)+i.slice(t+1)}}}else n=i.slice(0,this.getCursorPosInUnmaskedValue(s))+i.slice(this.getCursorPosInUnmaskedValue(a)),r=this.getCursorPosInUnmaskedValue(s);this.setValue(n),this.setCursorPositionInFormatted(r)}else(e.shiftKey||t<48||t>57)&&(t<96||t>105)&&e.preventDefault()}getCursorPosInUnmaskedValue(e){if(-1===this.activeMaskIndex)return e;const t=this.masksData[this.activeMaskIndex];let s=0;for(let a=0;a<e;a++)t.mask[a]===t.placeholderChar&&s++;return s}setCursorPositionInFormatted(e){if(-1===this.activeMaskIndex)return void this.input.setSelectionRange(e,e);const t=this.masksData[this.activeMaskIndex];let s=0,a=0;for(let i=0;i<t.mask.length;i++){if(t.mask[i]===t.placeholderChar){if(a===e){s=i;break}a++}s++}for(;s<t.mask.length&&t.mask[s]!==t.placeholderChar;)s++;this.input.setSelectionRange(s,s)}handlePaste(e){e.preventDefault();const t=(e.clipboardData||window.clipboardData).getData("text");this.setValue(t.replace(/\D/g,"")),this.adjustCursorPosition()}handleInput(e){if("deleteContentBackward"===e.inputType||"deleteContentForward"===e.inputType)return;let t=e.target.value.replace(/\D/g,""),s=-1,a=1/0,i="";for(let e=0;e<this.masksData.length;e++){const n=this.masksData[e];let r="",o=0;for(let e=0;e<n.mask.length;e++)n.mask[e]===n.placeholderChar?r+=o<t.length?t[o++]:"":r+=n.mask[e];if(n.regex.test(r)){const o=Math.abs(n.digitCount-t.length);o<a&&(a=o,s=e,i=r)}}this.activeMaskIndex=s,-1!==s&&this.masksData[s].regex.test(i)?e.target.value=i:e.target.value=t,this.validateInput(),this.adjustCursorPosition()}handleBlur(e){this.validateInput()}getUnmaskedValue(){return this.input.value.replace(/\D/g,"")}getValue(){if(!this.input||!this.input.value)return null;const e=this.input.value.replace(/\D/g,"");return 0===e.length?null:Number(e)}setValue(e){if(!this.input)return;if(null==e||""===e)return this.input.value="",this.activeMaskIndex=-1,void this.validateInput();let t=String(e).replace(/\D/g,""),s=-1,a=1/0,i="";for(let e=0;e<this.masksData.length;e++){const n=this.masksData[e];let r="",o=0;for(let e=0;e<n.mask.length;e++)n.mask[e]===n.placeholderChar?r+=o<t.length?t[o++]:"":r+=n.mask[e];if(n.regex.test(r)){const o=Math.abs(n.digitCount-t.length);o<a&&(a=o,s=e,i=r)}}this.activeMaskIndex=s,-1!==s&&this.masksData[s].regex.test(i)?this.input.value=i:this.input.value=t,this.validateInput()}adjustCursorPosition(){if(-1!==this.activeMaskIndex){const e=this.masksData[this.activeMaskIndex];let t=this.input.selectionStart;for(;t<this.input.value.length&&e.mask[t]!==e.placeholderChar;)t++;this.input.setSelectionRange(t,t)}}validateInput(){if(-1!==this.activeMaskIndex){const e=this.masksData[this.activeMaskIndex],t=e.regex.test(this.input.value),s=this.getUnmaskedValue().length===e.digitCount;t&&s?this.input.setCustomValidity(""):this.input.setCustomValidity(this.getErrorMessage())}else this.input.setCustomValidity(this.input.value?"":this.getErrorMessage())}}